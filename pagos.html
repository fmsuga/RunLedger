<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RunLedger</title>

<style>
:root{
  --bg:#0f0f0f;
  --surface:#1a1a1a;
  --border:#2a2a2a;
  --text:#e8e8e8;
  --muted:#777;
  --green:#4ade80;
  --yellow:#facc15;
  --red:#f87171;
}

*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg);
  color:var(--text);
  font-family:sans-serif;
  min-height:100vh;
  padding-bottom:90px;
}

header{
  padding:18px;
  border-bottom:1px solid var(--border);
  position:sticky;
  top:0;
  background:var(--bg);
  z-index:10;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

h1{font-size:.95rem;letter-spacing:.08em}

.tabs{
  display:flex;
  gap:14px;
  margin-top:14px;
  font-size:.8rem;
}

.tab{
  cursor:pointer;
  padding:6px 10px;
  border-radius:6px;
  border:1px solid var(--border);
}

.tab.active{
  background:var(--surface);
}

.small-actions{
  font-size:.7rem;
  color:var(--muted);
  display:flex;
  gap:12px;
}

.small-actions span{cursor:pointer}

.section{display:none}
.section.active{display:block}

#lista{
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:10px;
  padding:14px;
  display:flex;
  align-items:center;
  gap:12px;
}

.indicador{
  width:12px;
  height:12px;
  border-radius:50%;
}

.verde{background:var(--green)}
.amarillo{background:var(--yellow)}
.rojo{background:var(--red)}

.info{flex:1}
.nombre{font-weight:bold;font-size:.95rem}
.sub{font-size:.7rem;color:var(--muted);margin-top:3px}

.actions{
  display:flex;
  gap:8px;
}

button{
  cursor:pointer;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  padding:8px 10px;
  border-radius:6px;
  font-size:.85rem;
}

.btn-pagar{color:var(--green)}
.btn-eliminar{color:var(--red)}

#btn-agregar{
  position:fixed;
  bottom:20px;
  right:20px;
  background:white;
  color:black;
  border:none;
  padding:14px 18px;
  border-radius:10px;
  font-weight:bold;
  font-size:.9rem;
}

.stats{
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:14px;
  font-size:.9rem;
}

.stat-box{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:10px;
  padding:14px;
}

.stat-title{
  font-size:.7rem;
  color:var(--muted);
  margin-bottom:6px;
}

.stat-value{
  font-size:1.1rem;
  font-weight:bold;
}

.empty{
  text-align:center;
  padding:60px 20px;
  color:var(--muted);
  font-size:.85rem;
}
</style>
</head>
<body>

<header>
  <div class="topbar">
    <h1>RUNLEDGER</h1>
    <div class="small-actions">
      <span onclick="configurarPrecio()">⚙️</span>
      <span onclick="exportar()">Exportar</span>
      <span onclick="document.getElementById('importFile').click()">Importar</span>
      <input type="file" id="importFile" hidden accept=".json" onchange="importar(event)">
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="cambiarTab('alumnos')">Alumnos</div>
    <div class="tab" onclick="cambiarTab('resumen')">Resumen</div>
  </div>
</header>

<!-- ALUMNOS -->
<div id="alumnos" class="section active">
  <div id="lista"></div>
  <button id="btn-agregar" onclick="agregarAlumno()">+ Nuevo alumno</button>
</div>

<!-- RESUMEN -->
<div id="resumen" class="section">
  <div class="stats" id="stats"></div>
</div>

<script>
const KEY_DATA="runledger_alumnos";
const KEY_CONFIG="runledger_config";

function cargar(){return JSON.parse(localStorage.getItem(KEY_DATA))||[]}
function guardar(d){localStorage.setItem(KEY_DATA,JSON.stringify(d))}
function cargarConfig(){return JSON.parse(localStorage.getItem(KEY_CONFIG))||{precio:0}}
function guardarConfig(c){localStorage.setItem(KEY_CONFIG,JSON.stringify(c))}

function getMesActual(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;
}

function getDiaActual(){return new Date().getDate()}

function estado(a){
  if(a.ultimoMesPagado===getMesActual()) return "verde";
  return getDiaActual()<=10?"amarillo":"rojo";
}

function agregarAlumno(){
  const nombre=prompt("Nombre del alumno:");
  if(!nombre) return;
  const data=cargar();
  data.push({
    id:Date.now(),
    nombre:nombre.trim(),
    fechaAlta:new Date().toISOString().slice(0,10),
    ultimoMesPagado:null
  });
  guardar(data);
  render();
}

function eliminar(id){
  guardar(cargar().filter(a=>a.id!==id));
  render();
}

function pagar(id){
  const data=cargar();
  const alumno=data.find(a=>a.id===id);
  if(!alumno) return;
  if(alumno.ultimoMesPagado===getMesActual()) return;
  if(!confirm(`¿Confirmás que pagó ${alumno.nombre}?`)) return;
  alumno.ultimoMesPagado=getMesActual();
  guardar(data);
  render();
}

function render(){
  renderAlumnos();
  renderResumen();
}

function renderAlumnos(){
  const data=cargar();
  const lista=document.getElementById("lista");
  if(!data.length){
    lista.innerHTML='<div class="empty">No hay alumnos todavía</div>';
    return;
  }
  lista.innerHTML=data.map(a=>{
    const est=estado(a);
    return `
    <div class="card">
      <div class="indicador ${est}"></div>
      <div class="info">
        <div class="nombre">${a.nombre}</div>
        <div class="sub">Alta: ${a.fechaAlta} · Último pago: ${a.ultimoMesPagado||"ninguno"}</div>
      </div>
      <div class="actions">
        <button class="btn-pagar" onclick="pagar(${a.id})">✔</button>
        <button class="btn-eliminar" onclick="if(confirm('¿Eliminar alumno?')) eliminar(${a.id})">✕</button>
      </div>
    </div>`;
  }).join("");
}

function renderResumen(){
  const data=cargar();
  const config=cargarConfig();
  const precio=config.precio||0;

  const total=data.length;
  const pagaron=data.filter(a=>a.ultimoMesPagado===getMesActual()).length;
  const deben=total-pagaron;

  const esperado=total*precio;
  const ingresado=pagaron*precio;
  const faltante=esperado-ingresado;
  const porcentaje=total?Math.round((pagaron/total)*100):0;

  document.getElementById("stats").innerHTML=`
  <div class="stat-box">
    <div class="stat-title">Total alumnos</div>
    <div class="stat-value">${total}</div>
  </div>
  <div class="stat-box">
    <div class="stat-title">Pagaron este mes</div>
    <div class="stat-value">${pagaron}</div>
  </div>
  <div class="stat-box">
    <div class="stat-title">Deben</div>
    <div class="stat-value">${deben}</div>
  </div>
  <div class="stat-box">
    <div class="stat-title">Ingreso esperado</div>
    <div class="stat-value">$${esperado}</div>
  </div>
  <div class="stat-box">
    <div class="stat-title">Ingreso real</div>
    <div class="stat-value">$${ingresado}</div>
  </div>
  <div class="stat-box">
    <div class="stat-title">Faltante</div>
    <div class="stat-value">$${faltante}</div>
  </div>
  <div class="stat-box">
    <div class="stat-title">% Cobrado</div>
    <div class="stat-value">${porcentaje}%</div>
  </div>`;
}

function configurarPrecio(){
  const config=cargarConfig();
  const nuevo=prompt("Precio mensual actual:",config.precio||"");
  if(nuevo===null) return;
  guardarConfig({precio:Number(nuevo)});
  render();
}

function exportar(){
  const blob=new Blob([JSON.stringify(cargar())],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="runledger_backup.json";
  a.click();
}

function importar(e){
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    guardar(JSON.parse(reader.result));
    render();
  };
  reader.readAsText(file);
}

function cambiarTab(tab){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(tab).classList.add("active");
  document.querySelector(`.tab[onclick="cambiarTab('${tab}')"]`).classList.add("active");
}

render();
</script>

</body>
</html>